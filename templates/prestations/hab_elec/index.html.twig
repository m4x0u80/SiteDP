{# templates/prestations/hab_elec/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Habilitations Électriques – DP Formation{% endblock %}

{# Image hero (change le nom si besoin) #}
{% set HERO_REMOTE = asset('images/hab_elec.jpg') %}
{% set HERO_LOCAL  = asset('images/hab_elec.jpg') %}

{% block meta %}
  <link rel="preload" as="image" href="{{ HERO_REMOTE }}">
{% endblock %}

{% block body %}
{# ========== HERO avec image qui défile ========== #}
<section id="heroScroll" class="relative min-h-[60vh]">
  <div id="heroViewport" class="sticky top-0 h-[60vh] overflow-hidden">
    <img
      id="heroImg"
      src="{{ HERO_REMOTE }}"
      alt="Habilitations Électriques – DP Formation"
      class="absolute inset-0 h-full w-full object-cover"
      style="object-position:50% 0%; transition:object-position 180ms ease-out; will-change:object-position;"
      onerror="this.onerror=null;this.src='{{ HERO_LOCAL }}';"
      loading="eager"
      fetchpriority="high"
    />
    <div class="absolute inset-0 bg-blue-600/40 mix-blend-multiply"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#ECF5FF]"></div>

    <div class="relative z-10 flex h-full items-center">
      <div class="mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl">
          <h1 class="text-3xl font-bold sm:text-4xl md:text-5xl">
            Habilitations Électriques
          </h1>
          <p class="mt-3 text-base text-white/80 sm:text-lg">
            Formations aux habilitations électriques adaptées à vos équipes et à vos installations.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

{# ========== SECTION CARTES (fond #ECF5FF) ========== #}
<section class="bg-[#ECF5FF] py-12 text-slate-900">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <h2 class="text-center text-xl font-bold">Nos habilitations électriques</h2>

    {# Fallback si le contrôleur n’envoie pas encore $categories #}
    {% set categories = categories is defined and categories ? categories : {
      'b0-h0'  : 'B0 / H0 / H0V',
      'bs-be'  : 'BS / BE Manoeuvre',
      'b1-b2'  : 'B1 / B2 / BR / BC',
      'bf-hf'  : 'BF / HF'
    } %}

    {# Cartes centrées #}
    <div class="mt-8 flex flex-wrap justify-center gap-6">
      {% for key, label in categories %}
        <article
          class="group flex flex-col w-full max-w-xs sm:w-64 rounded-2xl bg-white p-5 ring-1 ring-slate-200 shadow-sm hover:shadow-md transition-shadow">
          <a href="{{ path('app_formations_hab_elec_cat', {cat: key}) }}" class="flex flex-col h-full">
            {# Image en haut #}
            <div class="flex items-center gap-3">
              <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-slate-100">
                <img
                  src="{{ asset('images/electricite.png') }}"
                  alt="Habilitation {{ label }}"
                  class="h-8 w-8 object-contain"
                  loading="lazy"
                />
              </div>
              <h3 class="text-base font-bold leading-tight">
                {{ label }}
              </h3>
            </div>

            <p class="mt-3 text-sm text-slate-700 flex-1">
              Formation à la prévention du risque électrique et à la mise en sécurité des interventions.
            </p>

            <div class="mt-4 flex justify-end">
              <span
                class="inline-flex items-center rounded-lg bg-[#1d4ed8] px-3 py-2 text-xs font-bold text-white shadow group-hover:bg-[#1b45c3]">
                Voir la fiche
              </span>
            </div>
          </a>
        </article>
      {% endfor %}
    </div>

    {# ---- Bouton retour vers “Nos prestations” ---- #}
    <div class="mt-10 text-center">
      <a href="{{ path('app_prestations') }}"
         class="inline-flex items-center gap-2 rounded-xl bg-[#0000FF] px-4 py-2 text-white text-sm font-semibold shadow hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        ← Retour “Nos prestations”
      </a>
    </div>
  </div>
</section>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // Parallax smooth pour l'image hero
    (function () {
      const wrapper  = document.getElementById('heroScroll');
      const viewport = document.getElementById('heroViewport');
      const img      = document.getElementById('heroImg');
      if (!wrapper || !viewport || !img) return;

      let curr = 0, target = 0, rafId = null;

      function computeTarget() {
        const start = wrapper.getBoundingClientRect().top + window.scrollY;
        const range = Math.max(1, viewport.offsetHeight);
        const y = window.scrollY - start;
        const pRaw = Math.min(Math.max(y / range, 0), 1);
        target = Math.min(pRaw, 0.97);
        tick();
      }

      function tick() {
        if (rafId) return;
        rafId = requestAnimationFrame(function animate() {
          rafId = null;
          curr += (target - curr) * 0.12;
          if (Math.abs(target - curr) < 0.001) {
            curr = target;
          } else {
            rafId = requestAnimationFrame(animate);
          }
          img.style.objectPosition = `50% ${Math.round(curr * 100)}%`;
        });
      }

      computeTarget();
      window.addEventListener('scroll', computeTarget, { passive: true });
      window.addEventListener('resize', computeTarget);
    })();
  </script>
{% endblock %}
