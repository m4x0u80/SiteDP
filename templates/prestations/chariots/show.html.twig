{# templates/prestations/show.html.twig #}
{% extends 'base.html.twig' %}

{# ------- Données attendues (avec valeurs par défaut) ------- #}
{% set page = page ?? {} %}

{# >>> ICI : image hero par défaut = CACES_R489_1A <<< #}
{% set hero_src   = page.hero_src   ?? asset('images/CACES_R489_1A.png') %}
{% set hero_src2x = page.hero_src2x ?? asset('images/CACES_R489_1A.png') %}

{% set titre      = page.titre      ?? 'CACES® R489 – Catégorie 1A' %}
{% set resume     = page.resume     ?? 'Maîtrisez la conduite en sécurité, pour tous types d’engins' %}

{% set description = page.description ?? "
Transpalettes à conducteur porté et préparateurs de commandes, sans élévation du poste de conduite, avec une hauteur de levée limitée à 1,20 m.


Objectifs de la formation :

- Comprendre et appliquer les règles de sécurité liées à l’utilisation des chariots élévateurs

- Maîtriser les principales manœuvres : chargement et déchargement de camions, stockage/déstockage en palettier, déplacement de charges, etc...

- Acquérir les bases technologiques des chariots élévateurs et savoir lire une plaque de capacité


Pré-requis :

- Maîtrise de la langue française

- Connaissance des calculs de base (addition, soustraction, etc...)

- Être âgé de 18 ans minimum


Moyens pédagogiques :

- Ordinateur et vidéo-projecteur

- Supports de cours et vidéos pédagogiques

- Chariots élévateurs de différentes catégories

- Plateforme logistique conforme aux exigences du référentiel CACES® R489


Équipements nécessaires pour les participants :
(En cas de besoin, DP Formation peut fournir une partie de ces équipements, dans la limite des stocks disponibles — hors chaussures de sécurité.)

- Chaussures de sécurité

- Gants

- Gilet réfléchissant


Sanction de la formation :

- Évaluation théorique

- Évaluation pratique (pour chaque catégorie)

- Délivrance d’un CACES® et d’une attestation de formation en cas de réussite aux évaluations


Contenu théorique de la formation :

- Identifier le rôle des différentes instances de prévention : Inspection du Travail, Assurance Maladie / Cramif, Médecine du travail, organismes de contrôle technique, etc...

- Connaître les conditions nécessaires pour conduire un chariot élévateur et les responsabilités associées

- Reconnaître les principales catégories de chariots, leurs caractéristiques, leurs usages habituels et leurs limites

- Comprendre la technologie et la fonction des organes principaux : groupe propulseur, circuit hydraulique, mât, tablier porte-charge…

- Comprendre le fonctionnement des organes de service et des dispositifs de sécurité : coupe-circuit, frein de service, clés et dispositifs de condamnation, etc...

- Savoir lire et interpréter les pictogrammes et panneaux de signalisation

- Identifier les principales causes d’accidents liés à l’utilisation d’un chariot automoteur

- Repérer les risques potentiels présents sur un trajet défini

- Lire une plaque de charge et en déduire les conditions de stabilité du chariot

- Connaître les dispositifs de sécurité du conducteur : protège-conducteur, dosseret, bouclier, réglages du siège, équipements de protection individuelle, etc...

- Expliquer et justifier les interdictions concernant le transport ou l’élévation de personnes

- Connaître les règles de circulation et de conduite en intérieur comme en extérieur

- Comprendre l’influence des paramètres (état du sol, poids, vitesse…) sur la distance de freinage

- Identifier les produits dangereux à partir de leur étiquetage et connaître les risques liés à leur manutention


Contenu pratique de la formation :

- Vérifier l’adéquation du chariot à la manutention prévue

- Réaliser les contrôles et opérations nécessaires en début et fin de poste

- Circuler à vide et en charge, en marche avant/arrière, en virage et immobiliser le chariot en position de sécurité

- Circuler et s’arrêter sur un plan incliné

- Prendre et déposer une charge au sol

- Réaliser un gerbage et un dégerbage en pile

- Mettre en stock et déstocker des charges à tous les niveaux d’un palettier

- Charger et décharger un camion ou une remorque latéralement depuis le sol

- Charger et décharger une remorque à partir d’un quai par l’arrière

- Réaliser des opérations de picking (catégorie 7)

- Circuler avec une remorque en marche avant et marche arrière (catégorie 2B)

- Prendre, transporter et déposer des charges longues ou volumineuses

- Identifier les anomalies et difficultés rencontrées et les signaler à la hiérarchie

- Réaliser les opérations de maintenance relevant de son niveau


Validation (selon le référentiel R489) :

- Évaluation théorique

- Évaluation pratique : un parcours pratique par catégorie
" %}

{% set programme_url = page.programme_url ?? '#' %}

{% set tarifs = page.tarifs ?? {
  'inter': 'à partir de 100€',
  'intra': 'sur devis'
} %}

{% set reserve_url = page.reserve_url ?? path('app_contact') %}

{% set infos = page.infos ?? {
  'Durée'  : '3 jours',
  'Horaires' : '8 h 30 - 12 h / 13 h - 16 h 30',
  'Lieu'   : 'DP Formation Saint-Quentin',
  'Public' : 'Caristes, manutentionnaires, opérateurs…', 
  'Validité' : '5 ans'
} %}

{% block title %}{{ titre }} – DP Formation{% endblock %}

{% block meta %}
  <link rel="preload" as="image" href="{{ hero_src }}">
{% endblock %}

{% block body %}
{# ================= HERO (parallax 60vh) ================= #}
<section id="heroScroll" class="relative min-h-[60vh]">
  <div id="heroViewport" class="sticky top-0 h-[60vh] overflow-hidden">
    <img id="heroImg"
         src="{{ hero_src }}"
         srcset="{{ hero_src }} 1x, {{ hero_src2x }} 2x"
         alt="{{ titre }}"
         class="absolute inset-0 h-full w-full object-cover"
         style="object-position:50% 0%; transition:object-position 180ms ease-out; will-change:object-position;"
         loading="eager" fetchpriority="high" />
    <div class="absolute inset-0 bg-blue-600/40 mix-blend-multiply"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[#ECF5FF]"></div>

    <div class="relative z-10 flex h-full items-center">
      <div class="mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="max-w-3xl">
          <h1 class="text-3xl font-bold sm:text-4xl md:text-5xl">{{ titre }}</h1>
          <p class="mt-3 text-base text-white/80 sm:text-lg">{{ resume }}</p>
        </div>
      </div>
    </div>
  </div>
</section>

{# ================= CONTENU ================= #}
<section class="bg-[#ECF5FF] py-12 text-slate-900">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

    {# ---- Ligne du haut : Infos pratiques + Tarifs ---- #}
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">

      {# Colonne gauche : Infos pratiques #}
      <article class="rounded-2xl bg-white ring-1 ring-slate-200 p-6 shadow-sm">
        <h2 class="text-lg font-bold">Infos pratiques</h2>
        <ul class="mt-4 space-y-3 text-sm">
          {% for label, value in infos %}
            <li class="flex items-start gap-3">
              <span class="mt-1 inline-block h-2 w-2 rounded-full bg-blue-600"></span>
              <p><span class="font-semibold">{{ label }} :</span> {{ value }}</p>
            </li>
          {% endfor %}
        </ul>
      </article>

      {# Colonne droite : Tarifs + CTA #}
      <aside class="rounded-2xl bg-white ring-1 ring-slate-200 p-6 shadow-sm">
        <h2 class="text-lg font-bold">Tarif de formation</h2>

        <dl class="mt-4 space-y-3 text-sm">
          <div class="flex items-center justify-between">
            <dt class="text-slate-700">inter-entreprises :</dt>
            <dd class="font-semibold">{{ tarifs.inter }}</dd>
          </div>
          <div class="flex items-center justify-between">
            <dt class="text-slate-700">intra-entreprise :</dt>
            <dd class="font-semibold">{{ tarifs.intra }}</dd>
          </div>
        </dl>

        <div class="mt-5">
          <a href="{{ path('app_home', {'_fragment': 'reservation'}) }}"
             class="inline-flex w-full items-center justify-center rounded-lg bg-[#1d4ed8] px-4 py-2 text-sm font-semibold text-white shadow hover:bg-[#1b45c3] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Réserver cette formation
          </a>
        </div>
      </aside>
    </div>

    {# ---- Description de la formation (en dessous, pleine largeur) ---- #}
    <div class="mt-6 rounded-2xl bg-white ring-1 ring-slate-200 p-6 shadow-sm">
      <h2 class="text-lg font-bold">Description de la formation</h2>
      <div class="prose prose-sm mt-4 max-w-none text-slate-800">
        <p style="white-space:pre-line">{{ description|raw }}</p>
      </div>
      <br>
      <div class="mt-4">
        <a href="https://www.francecompetences.fr/recherche/rs/6866/"
           class="inline-flex items-center rounded-lg bg-[#1d4ed8] px-4 py-2 text-sm font-semibold text-white shadow hover:bg-[#1b45c3] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          Fiche RS
        </a>
      </div>
    </div>

    {# ---- Bouton retour ---- #}
    <div class="mt-10 text-center">
      <a href="{{ path('app_formations_chariots') }}"
         class="inline-flex items-center gap-2 rounded-xl bg-[#0000FF] px-4 py-2 text-white text-sm font-semibold shadow hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        ← Retour “Chariots”
      </a>
    </div>

  </div>
</section>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    // Parallax smooth identique aux autres pages
    (function () {
      const wrapper = document.getElementById('heroScroll');
      const viewport = document.getElementById('heroViewport');
      const img = document.getElementById('heroImg');
      if (!wrapper || !viewport || !img) return;

      let curr = 0, target = 0, rafId = null;
      function computeTarget() {
        const start = wrapper.getBoundingClientRect().top + window.scrollY;
        const range = Math.max(1, viewport.offsetHeight);
        const y = window.scrollY - start;
        const pRaw = Math.min(Math.max(y / range, 0), 1);
        target = Math.min(pRaw, 0.97);
        tick();
      }
      function tick() {
        if (rafId) return;
        rafId = requestAnimationFrame(function animate() {
          rafId = null;
          curr += (target - curr) * 0.12;
          if (Math.abs(target - curr) < 0.001) curr = target;
          else rafId = requestAnimationFrame(animate);
          img.style.objectPosition = `50% ${Math.round(curr * 100)}%`;
        });
      }
      computeTarget();
      window.addEventListener('scroll', computeTarget, { passive: true });
      window.addEventListener('resize', computeTarget);
    })();
  </script>
{% endblock %}
